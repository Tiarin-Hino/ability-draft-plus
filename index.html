<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data:; script-src 'self'; style-src 'self' 'unsafe-inline'">
    <title data-i18n="controlPanel.header">Dota 2 Ability Draft Plus - Control Panel</title>
    <style>
        /* CSS Variables for Theming */
        :root {
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            /* Light Theme (Default) */
            --bg-color: #f4f4f4;
            --text-color: #333;
            --text-color-muted: #555;
            --header-color: #2c3e50;
            --section-bg: #fff;
            --section-shadow: rgba(0, 0, 0, 0.1);
            --hr-bg: #ddd;
            --status-bg: #e9ecef;
            --status-border: #7f8c8d;
            --footer-bg: #e9ecef;
            --footer-border-top: #ddd;

            --button-default-bg: #3498db;
            --button-default-hover-bg: #2980b9;
            --button-default-text: white;
            --button-disabled-bg: #bdc3c7;
            --button-disabled-opacity: 0.7;

            --button-activate-bg: #2ecc71;
            --button-activate-hover-bg: #27ae60;
            --button-export-bg: #f39c12;
            --button-export-hover-bg: #e67e22;
            --button-feedback-bg: #9b59b6;
            --button-feedback-hover-bg: #8e44ad;
            --button-samples-bg: #9b59b6;
            --button-samples-hover-bg: #8e44ad;

            --button-support-bg: #292F3F;
            --button-support-hover-bg: #3d4455;
            --button-support-border: #1a1e28;
            --button-support-text: white;


            --select-bg: white;
            --select-border: #ccc;
            --select-text: #333;

            --theme-option-text: #444;
            --toggle-bg-inactive: #ccc;
            --toggle-bg-active: var(--button-activate-bg);
            /* Or a specific theme color */
            --toggle-slider-bg: white;
            --toggle-disabled-opacity: 0.5;
        }

        body.dark-mode {
            /* Dark Theme Overrides */
            --bg-color: #23272a;
            --text-color: #dcddde;
            --text-color-muted: #b9bbbe;
            --header-color: #ffffff;
            --section-bg: #2c2f33;
            --section-shadow: rgba(0, 0, 0, 0.4);
            /* Darker shadow */
            --hr-bg: #4f545c;
            --status-bg: #2c2f33;
            --status-border: #4f545c;
            --footer-bg: #23272a;
            --footer-border-top: #2c2f33;

            --button-default-bg: #5865f2;
            /* Discord Blurple */
            --button-default-hover-bg: #4f5bda;
            --button-disabled-bg: #4f545c;

            --button-activate-bg: #43b581;
            /* Discord Green */
            --button-activate-hover-bg: #3aa570;
            --button-export-bg: #faa61a;
            --button-export-hover-bg: #f0960a;
            --button-feedback-bg: #5865f2;
            --button-feedback-hover-bg: #4f5bda;
            --button-samples-bg: #5865f2;
            --button-samples-hover-bg: #4f5bda;

            --button-support-bg: #4f545c;
            --button-support-hover-bg: #5a6066;
            --button-support-border: #40444b;

            --select-bg: #40444b;
            --select-border: #2d2f33;
            --select-text: #dcddde;

            --theme-option-text: #b9bbbe;
            --toggle-bg-inactive: #72767d;
            /* Darker inactive toggle */
            --toggle-bg-active: var(--button-activate-bg);
            --toggle-slider-bg: #b9bbbe;
            /* Lighter slider for dark bg */
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .language-switcher {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-switcher label {
            margin-bottom: 0;
            font-weight: normal;
            font-size: 0.9em;
            color: var(--theme-option-text);
        }

        /* Apply variables to existing styles */
        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.2s ease-out, color 0.2s ease-out;
        }

        header {
            padding: 15px 20px;
            /* Adjusted padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--footer-border-top);
            /* Consistent separator */
            transition: border-bottom-color 0.2s ease-out;
        }

        main {
            padding: 20px;
            flex-grow: 1;
        }

        h1 {
            color: var(--header-color);
            text-align: left;
            margin: 0;
            font-size: 1.8em;
            /* Slightly larger */
            flex-grow: 1;
        }


        section {
            background-color: var(--section-bg);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px var(--section-shadow);
            transition: background-color 0.2s ease-out, box-shadow 0.2s ease-out;
        }

        button {
            padding: 10px 15px;
            background-color: var(--button-default-bg);
            color: var(--button-default-text) !important;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.15s ease-out;
        }

        button:hover {
            background-color: var(--button-default-hover-bg);
        }

        button:disabled {
            background-color: var(--button-disabled-bg) !important;
            cursor: not-allowed;
            opacity: var(--button-disabled-opacity);
        }

        /* Specific button background colors using variables */
        #update-all-data-btn {
            background-color: var(--button-default-bg);
        }

        #update-all-data-btn:hover {
            background-color: var(--button-default-hover-bg);
        }

        #activate-overlay-btn {
            background-color: var(--button-activate-bg);
        }

        #activate-overlay-btn:hover {
            background-color: var(--button-activate-hover-bg);
        }

        #export-failed-samples-btn {
            background-color: var(--button-export-bg);
        }

        #export-failed-samples-btn:hover {
            background-color: var(--button-export-hover-bg);
        }

        #share-feedback-ext-btn {
            background-color: var(--button-feedback-bg);
        }

        #share-feedback-ext-btn:hover {
            background-color: var(--button-feedback-hover-bg);
        }

        #share-samples-ext-btn {
            background-color: var(--button-samples-bg);
        }

        #share-samples-ext-btn:hover {
            background-color: var(--button-samples-hover-bg);
        }

        .support-button {
            background-color: var(--button-support-bg);
            border: 1px solid var(--button-support-border);
            color: var(--button-support-text) !important;
        }

        .support-button:hover {
            background-color: var(--button-support-hover-bg);
        }

        .button-icon {
            width: 20px;
            height: 20px;
        }

        select {
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid var(--select-border);
            background-color: var(--select-bg);
            color: var(--select-text);
            transition: background-color 0.2s ease-out, color 0.2s ease-out, border-color 0.2s ease-out;
        }

        hr {
            border: 0;
            height: 1px;
            background: var(--hr-bg);
            margin: 20px 0;
        }

        p {
            margin-bottom: 10px;
        }

        .status {
            padding: 10px;
            background-color: var(--status-bg);
            border-left: 4px solid var(--status-border);
            margin-top: 15px;
            border-radius: 4px;
            transition: background-color 0.2s ease-out, border-left-color 0.2s ease-out;
        }

        .last-updated {
            font-size: 0.9em;
            color: var(--text-color-muted);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .button-group-inline {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .app-footer {
            padding: 20px;
            text-align: center;
            background-color: var(--footer-bg);
            border-top: 1px solid var(--footer-border-top);
            margin-top: auto;
            transition: background-color 0.2s ease-out, border-top-color 0.2s ease-out;
        }

        .support-buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        /* Theme Switcher Styles */
        .theme-switcher {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: var(--theme-option-text);
        }

        .theme-option label {
            margin-bottom: 0;
            font-weight: normal;
        }

        /* Adjust label style within theme option */
        .manual-theme-controls .theme-label {
            font-size: 0.9em;
            color: var(--text-color-muted);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            /* Slightly smaller */
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg-inactive);
            transition: .3s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: var(--toggle-slider-bg);
            transition: .3s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--toggle-bg-active);
        }

        input:focus+.slider {
            box-shadow: 0 0 1px var(--toggle-bg-active);
        }

        input:checked+.slider:before {
            transform: translateX(22px);
        }

        .manual-theme-controls.disabled .switch,
        .manual-theme-controls.disabled .theme-label {
            opacity: var(--toggle-disabled-opacity);
        }

        .manual-theme-controls.disabled .switch input {
            pointer-events: none;
            /* Disable clicks on the input itself */
            cursor: not-allowed;
        }

        .manual-theme-controls.disabled .slider {
            cursor: not-allowed;
        }

        .custom-popup {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.65);
            display: none;
            /* Controlled by JS adding/removing .visible */
            justify-content: center;
            align-items: center;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease-in-out, visibility 0s linear 0.25s;
        }

        .custom-popup.visible {
            display: flex;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.25s ease-in-out;
        }

        .custom-popup-content {
            /* Content box for the mismatch popup */
            background-color: var(--section-bg);
            padding: 25px 35px;
            border-radius: 8px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 450px;
            /* Adjusted width */
            color: var(--text-color);
            border: 1px solid var(--hr-bg);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .custom-popup-message-text {
            /* Class for the message paragraph */
            margin-bottom: 10px;
            /* Adjusted */
            line-height: 1.6;
            font-size: 1.0em;
            /* Adjusted */
        }

        .custom-popup-buttons {
            /* Container for the popup's own buttons */
            display: flex;
            justify-content: space-evenly;
            gap: 15px;
        }

        .custom-popup-buttons button {
            /* Styling for buttons inside this specific popup */
            padding: 10px 18px;
            font-weight: 500;
        }

        #custom-popup-submit-layout-btn {
            /* Specific button in mismatch popup */
            background-color: var(--button-activate-bg);
        }

        #custom-popup-submit-layout-btn:hover {
            background-color: var(--button-activate-hover-bg);
        }

        #custom-popup-change-res-btn {
            /* Specific button in mismatch popup */
            background-color: var(--button-default-bg);
        }

        #custom-popup-change-res-btn:hover {
            background-color: var(--button-default-hover-bg);
        }
    </style>
</head>

<body>
    <header>
        <h1 data-i18n="appTitle">Dota 2 Ability Draft Plus</h1>
        <div class="header-controls">
            <div class="language-switcher">
                <label for="language-select" data-i18n="controlPanel.lang.label">Language</label>
                <select id="language-select">
                    <option value="en">English</option>
                    <option value="ru">Русский</option>
                </select>
            </div>
            <div class="theme-switcher">
                <div class="theme-option">
                    <input type="checkbox" id="system-theme-checkbox" title="Follow operating system theme setting">
                    <label for="system-theme-checkbox" data-i18n="controlPanel.theme.system">Use System
                        Preference</label>
                </div>
                <div class="theme-option manual-theme-controls">
                    <span class="theme-label" data-i18n="controlPanel.theme.light">Light</span>
                    <label class="switch" title="Toggle between Light and Dark mode">
                        <input type="checkbox" id="light-dark-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span class="theme-label" data-i18n="controlPanel.theme.dark">Dark</span>
                </div>
            </div>
        </div>
    </header>

    <main>

        <section id="status-section">
            <h2 data-i18n="controlPanel.status.title">Application Status</h2>
            <p id="status-message" class="status" data-i18n="controlPanel.status.ready">Ready.</p>
        </section>

        <hr>

        <section id="overlay-activation-section">
            <h2 data-i18n="controlPanel.activation.title">Overlay Activation</h2>
            <div>
                <label for="resolution-select" data-i18n="controlPanel.activation.label">Select screen resolution for
                    scanning:</label>
                <select id="resolution-select" aria-describedby="resolution-help">
                    <option value="" data-i18n="controlPanel.status.loadingResolutions">Loading resolutions...</option>
                </select>
                <p id="resolution-help" style="font-size: 0.85em; color: var(--text-color-muted);"
                    data-i18n="controlPanel.activation.helpText">This resolution must
                    match your Dota 2
                    game setting.</p>
            </div>
            <p data-i18n="controlPanel.activation.description">Activate the overlay when Dota 2 is in the Ability Draft
                phase.</p>
            <button id="activate-overlay-btn" data-i18n="controlPanel.activation.button">Activate Overlay</button>
        </section>

        <hr>


        <section id="new-resolution-request-section">
            <h2 data-i18n="controlPanel.newResolution.title">Submit New Layout</h2>
            <p data-i18n="controlPanel.newResolution.description">If your screen resolution isn't listed, you can submit
                your current screen setup.
                Please ensure Dota 2 is in the Ability Draft phase, displaying the full draft interface, at the
                resolution you wish to add.</p>
            <button id="submit-new-resolution-btn" data-i18n="controlPanel.newResolution.button">Submit Current Screen
                Layout</button>
            <p id="new-resolution-status" class="status" style="display: none; margin-top: 10px;"></p>
        </section>

        <hr>

        <section id="data-management-section">
            <h2 data-i18n="controlPanel.data.title">Data Management</h2>
            <p data-i18n="controlPanel.data.description">Fetch all hero, ability, and pair data from Windrun.io. This
                may take a few moments.</p>
            <button id="update-all-data-btn" data-i18n="controlPanel.data.button">Update Windrun Data</button>
            <p class="last-updated" data-i18n="controlPanel.data.lastUpdated" data-i18n-date-param="last-updated-date">
                Last updated: <span id="last-updated-date">Checking...</span></p>
        </section>

        <hr>

        <section id="feedback-section">
            <h2 data-i18n="controlPanel.feedback.title">Feedback &amp; Diagnostics</h2>
            <p data-i18n="controlPanel.feedback.description">If the ML model misidentifies abilities, use the "Report
                Failed Recognition" feature in the overlay. You can then
                export or upload these snapshots for model improvement.</p>
            <div class="button-group-inline">
                <button id="export-failed-samples-btn" data-i18n="controlPanel.feedback.exportButton">Export Failed
                    Samples</button>
                <button id="share-samples-ext-btn" data-i18n="controlPanel.feedback.shareButton">Share Failed
                    Samples</button>
                <button id="upload-failed-samples-btn" data-i18n="controlPanel.feedback.uploadButton">Upload Failed
                    Samples</button>
                <button id="share-feedback-ext-btn" data-i18n="controlPanel.feedback.feedbackButton">Share
                    Feedback</button>
            </div>
        </section>
    </main>
    <div id="custom-resolution-popup" class="custom-popup">
        <div class="custom-popup-content">
            <p id="custom-popup-message" class="custom-popup-message-text"
                data-i18n="controlPanel.popups.resolutionMismatch.message"></p>
            <div class="custom-popup-buttons">
                <button id="custom-popup-submit-layout-btn"
                    data-i18n="controlPanel.popups.resolutionMismatch.submitBtn">Submit Resolution</button>
                <button id="custom-popup-change-res-btn"
                    data-i18n="controlPanel.popups.resolutionMismatch.changeBtn">Change Resolution</button>
            </div>
        </div>
    </div>

    <div id="screenshot-preview-popup" class="custom-popup">
        <div id="screenshot-preview-content" class="custom-popup-content">
            <h3 data-i18n="controlPanel.popups.screenshotPreview.title">Screenshot Preview</h3>
            <p data-i18n="controlPanel.popups.screenshotPreview.message">Is this screenshot of your draft screen
                correct?</p>
            <img id="screenshot-preview-image" src="" alt="Screenshot Preview"
                style="max-width: 100%; max-height: 50vh; border: 1px solid #555; margin-top: 10px;" />
            <div class="custom-popup-buttons" style="margin-top: 15px;">
                <button id="screenshot-submit-btn" class="overlay-button"
                    data-i18n="controlPanel.popups.screenshotPreview.submitBtn">Submit</button>
                <button id="screenshot-retake-btn" class="overlay-button"
                    data-i18n="controlPanel.popups.screenshotPreview.retakeBtn">Retake Screencapture</button>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <div class="support-buttons-container">
            <button id="support-dev-btn" class="support-button">
                <img src="./resources/images/ko-fi.svg" alt="Ko-fi icon" class="button-icon">
                <span data-i18n="controlPanel.footer.supportDev">Support Developer</span>
            </button>
            <button id="support-windrun-btn" class="support-button">
                <img src="./resources/images/ko-fi.svg" alt="Ko-fi icon" class="button-icon">
                <span data-i18n="controlPanel.footer.supportWindrun">Support Windrun.io</span>
            </button>
        </div>
    </footer>

    <script src="./renderer.js"></script>
</body>

</html>